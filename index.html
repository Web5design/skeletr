<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>{block:PostSummary}{PostSummary} - {/block:PostSummary} {Title}</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description" content="{MetaDescription}"/>

    <link rel="shortcut icon" href="{Favicon}"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="{RSS}"/>
    <link rel="stylesheet" href="http://static.tumblr.com/pki9kmq/Wttmg83dy/skeleton-1.2-base.css"/>
    <link rel="stylesheet" href="http://static.tumblr.com/pki9kmq/wERmg83e6/skeleton-1.2.css"/>

    <style type="text/css">
        body {
            background-color: #151515;
            color: #EAEAEA;
        }

        h1, h2, h3, h4, h5, h6 {
            color: #b5e853;
        }

        body, h1, h2, h3, h4, h5, h6 {
            font-family: Monaco, "Bitstream Vera Sans Mono", "Lucida Console", Terminal, monospace !important;
        }

        header h1 {
            text-align: center;
        }

        a:link, a:visited, a:hover, a:active {
            color: #63c0f5;
        }

        /* Posts */

        #posts {
            max-width: 100%;
            width: 730px;
            margin: 25px auto auto auto;
            font-size: 16px;
        }

        .post {
            position: relative;
            margin: 40px 0 20px 0;
            list-style: none;
        }

        .post img {
            display: block;
            max-width: 100%;
            margin: auto;
        }

        .post h3,
        .post ul,
        .post ol,
        .post img {
            margin-bottom: 20px;
        }

        .post .words {
            font-size: x-large;
        }

        .post-footer {
            text-align: right;
        }

        /* Skeleton overrides */

        li, li p {
            line-height: normal;
        }

        ul ul, ul ol, ol ol, ol ul {
            font-size: 100%;
        }

        blockquote {
            border-left: 1px solid #777;
            padding: 0 20px 0 19px;
        }
    </style>
</head>

<body>

<div class="container">

<header>
    <h1>bryan.io</h1>
</header>

<ul id="posts">
<!-- START POSTS -->

{block:Posts}
    {block:Regular}
        <li class="post regular">
        {block:Title}<h3>{Title}</h3>{/block:Title}
        {Body}
    {/block:Regular}

    {block:Quote}
        <li class="post quote">
            <div class="quote-body">
                <p class="words">&#0147;{Quote}&#0148;</p>
                {block:Source}<p class="source">&mdash; {Source}</p>{/block:Source}
            </div>
    {/block:Quote}

    {block:Link}
        <li class="post link">
            <h3><a href="{URL}" {Target}>{Name}</a></h3>

            <p class="link-body">
                {block:Description}{Description}{/block:Description}
            </p>
    {/block:Link}

    {block:Conversation}
        <li class="post conversation">
            {block:Title}<h3>{Title}</h3>{/block:Title}
            <ul>
                {block:Lines}
                <li>
                    {block:Label}<span class="person">{Label}</span>{/block:Label}
                    <span class="line">{Line}</span>
                </li>
                {/block:Lines}
            </ul>
    {/block:Conversation}

    {block:Photo}
        <li class="post photo">
            {LinkOpenTag}<img src="{PhotoURL-500}" alt="{PhotoAlt}"/>{LinkCloseTag}
            {block:Caption}
                <div class="caption">{Caption}</div>
            {/block:Caption}
    {/block:Photo}

    {block:Photoset}
        <li class="post photoset-post">
            {Photoset-500}
            {block:Caption}
                <div class="caption">{Caption}</div>
            {/block:Caption}
    {/block:Photoset}

    {block:Video}
        <li class="post video">
            {Video-500}
            {block:Caption}
                <div class="caption">{Caption}</div>
            {/block:Caption}
    {/block:Video}

    {block:Audio}
        <li class="post audio">
            {AudioPlayerBlack}
            {block:Caption}
                <div class="caption">{Caption}</div>
            {/block:Caption}
    {/block:Audio}

    <div class="post-footer">
        {block:RebloggedFrom}
            <span class="reblog">{lang:Reblogged from ReblogParentName 2},</span>
        {/block:RebloggedFrom}

        {block:Date}
            <a href="{Permalink}" class="permalink">{ShortMonth} {DayOfMonth} {Year} {12Hour}:{Minutes} {CapitalAmPm}</a>
        {/block:Date}

        <!--
        {block:IfShowNotes}
            {block:NoteCount}
                <a href="{Permalink}#notes-container" class="notes-link">{NoteCountWithLabel}</a>
            {/block:NoteCount}
        {/block:IfShowNotes}

        {block:HasTags}
            <span class="tags">{lang:Tags}:
            {block:Tags}
                <a href="{TagURL}">{Tag}</a>
            {/block:Tags}
            </span>
        {/block:HasTags}
        -->
    </div>

    <!--
    {block:Permalink}
        {block:IfShowNotes}
            {block:PostNotes}
                <div id="notes-container">
                    <h3>{lang:Notes}</h3>
                    {PostNotes}
                </div>
            {block:PostNotes}
        {/block:IfShowNotes}
    {/block:Permalink}
    -->

    </li>
{/block:Posts}

<!-- END POSTS -->
</ul>

</div>

<script src="http://assets.tumblr.com/javascript/jquery-1.7.2.min.js"></script>

<script>
    var Tumblelog = {};

    // AJAX
    Tumblelog.Ajax = (function(url, callbackFunction) {
        this.bindFunction = function (caller, object) {
            return function() {
                return caller.apply(object, [object]);
            };
        };

        this.stateChange = function (object) {
            if (this.request.readyState==4) this.callbackFunction(this.request.responseText);
        };

        this.getRequest = function() {
            if (window.ActiveXObject)
                return new ActiveXObject('Microsoft.XMLHTTP');
            else if (window.XMLHttpRequest)
                return new XMLHttpRequest();
            return false;
        };

        this.postBody = (arguments[2] || "");
        this.callbackFunction = callbackFunction;
        this.url = url;
        this.request = this.getRequest();

        if (this.request) {
            var req = this.request;
            req.onreadystatechange = this.bindFunction(this.stateChange, this);

            if (this.postBody!=="") {
                req.open("POST", url, true);
                req.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
                req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                req.setRequestHeader('Connection', 'close');
            } else {
                req.open("GET", url, true);
            }

            req.send(this.postBody);
        }
    });

    Tumblelog.Infinite = (function() {
        var _$window          = $(window);
        var _$posts           = $('#posts');
        var _trigger_post     = null;

        var _current_page     = {CurrentPage};
        var _total_pages      = {TotalPages};
        var _url              = document.location.href;
        var _infinite_timeout = null;
        var _is_loading       = false;
        var _posts_loaded     = false;

        var _Ajax = Tumblelog.Ajax;

        function init() {
            set_trigger();
            enable_scroll();
        }

        function set_trigger () {
            var $all_posts = _$posts.find('li.post');

            if (!_posts_loaded) {
                _posts_loaded = $all_posts.length;
            }

            if (_posts_loaded >= 4) {
                _trigger_post = _$posts.find('li.post:eq(' + ($all_posts.length - 4) + ')').get(0);
            } else if (_posts_loaded >= 3) {
                _trigger_post = _$posts.find('li.post:eq(' + ($all_posts.length - 3) + ')').get(0);
            } else {
                _trigger_post = _$posts.find('li.post:last').get(0);
            }
        };

        function in_viewport (el) {
            if (el == null) return;
            var top = el.offsetTop;
            var height = el.offsetHeight;

            while (el.offsetParent) {
                el = el.offsetParent;
                top += el.offsetTop;
            }

            return (top < (window.pageYOffset + window.innerHeight));
        };

        function enable_scroll() {
            $('#footer .pagination').hide();
            _$window.scroll(function(){
                clearTimeout(_infinite_timeout);
                infinite_timeout = setTimeout(infinite_scroll, 100);
            });
        }

        function disable_scroll() {
            clearTimeout(_infinite_timeout);
            $(window).unbind('scroll');
        }

        function infinite_scroll() {
            if (_is_loading) return;

            if (in_viewport(_trigger_post)) {
                load_more_posts(); // w00t
            }
        };

        function load_more_posts() {
            if (_is_loading) return;
            _is_loading = true;

            // Build URL
            if (_url.charAt(_url.length - 1) != '/') _url += '/';
            if (_current_page === 1) _url += 'page/1';
            _current_page++;
            _url = _url.replace('page/' + (_current_page - 1), 'page/' + _current_page);

            // Fetch
            _Ajax(_url, function(data) {
                var new_posts_html = data.split('<!-- START' + ' POSTS -->')[1].split('<!-- END' + ' POSTS -->')[0];
                var $new_posts = $('#posts', data);

                // Insert posts and update counters
                $('#posts').append(new_posts_html);
                _posts_loaded = $new_posts.find('li.post').length;

                if ((_posts_loaded > 0) && (_current_page < _total_pages)) {
                    set_trigger();
                    _is_loading = false;
                } else {
                    disable_scroll();
                }
            });
        }

        return {
            init: init
        };
    });

    $(function() {
        {block:IndexPage}
        if ( !($.browser.msie && (parseInt($.browser.version, 10) < 9) ) ) {
            var InfiniteScroll = new Tumblelog.Infinite;
            InfiniteScroll.init();
        }
        {/block:IndexPage}
    });
</script>

</body>
</html>
